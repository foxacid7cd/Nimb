#!/bin/zsh
set -e

() {
  local nvim_path=".build/nvim-macos-arm64/bin/nvim"
  local generate_cmd="swift run --package-path Modules generate"

  local generated_dir="Nimb/Sources/generated"
  $nvim_path --api-info | eval "$generate_cmd $generated_dir"

  local swiftformat="/opt/homebrew/bin/swiftformat"
  if [ -x "$swiftformat" ]; then
    $swiftformat --config .swiftformat $generated_dir
  fi
}
