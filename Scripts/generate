#!/usr/bin/env zsh
set -e

() {
  xcodebuild -workspace ./Nimb.xcworkspace -scheme generate -configuration Debug -destination platform=macos arch=arm64 name='My Mac' -derivedDataPath ./.build/DerivedData

  local nvim_path=".build/package/bin/nvim"
  local generate_cmd="./.build/DerivedData/Build/Products/Debug/generate"
  local generated_dir="Nimb/Sources/generated"
  $nvim_path --api-info | eval "$generate_cmd $generated_dir"

  local swiftformat="/opt/homebrew/bin/swiftformat"
  if [ -x "$swiftformat" ]; then
    $swiftformat --config .swiftformat $generated_dir
  fi
}
